<div class="container">

  <div class="row">
    <div class="col-md-10 mx-auto">

      <div class="row">
        <div class="col-6">
          <div class="mt-4 mb-4 bg-light d-inline-block">
            <h4 class="px-2 pt-2">ショッピングカート</h4>
          </div>
        </div>
        <div class="col-6 pt-5 pb-3 text-right">
          <%= link_to "カートを空にする", destroy_all_cart_items_path, class: "btn btn-danger", method: :delete %>
        </div>
      </div>

      <div class="row">
        <div class="col-12">
          <table class="table table-bordered table-hover">
            <thead class="bg-light">
              <tr>
                <th>商品名</th>
                <th>単価(税込)</th>
                <th>数量</th>
                <th>小計</th>
                <th><%= @cart_items.length %></th>
              </tr>
            </thead>
            <tbody>
              <% array = [] %>
              <% @cart_items.each do |cart_item| %>
                <tr>
                  <td>
                    <%= cart_item.item.name %>
                  </td>
                  <td>
                    <%= cart_item.item.price.to_s(:delimited) %>
                  </td>
                  <td  class="form-group">
                    <%= form_with model: cart_item, url: cart_item_path(cart_item.id), local: true do |f| %>
                      <%= f.select :amount, [["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9],["10",10]], prompt: "個数選択", class: "form-control" %>
                      <%= f.submit "変更", class: "btn btn-success" %>
                    <% end %>
                  </td>
                  <td>
                    <% subtotal = cart_item.item.price*cart_item.amount %>
                    <%= subtotal.to_s(:delimited) %>
                  </td>
                  <td>
                    <%= link_to "削除する", cart_item_path(cart_item.id), class: "btn btn-danger", method: :delete %>
                  </td>
                </tr>
                <% array << subtotal %>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>

      <div class="row">
        <div class="col-md-9">
          <%= link_to "買い物を続ける", items_path, class: "btn btn-primary" %>
        </div>
        <div class="col-md-3">
          <table class="table table-bordered">
            <tbody>
              <tr>
                <td class="bg-light">合計金額</td>
                <td>
                  <% total_price = array.sum %>
                  <%= total_price.to_s(:delimited) %>
                </td>
              </tr>
            </tbody>
          </table>

        </div>
      </div>

      <div class="text-center pt-4">
        <%= link_to "注文情報に進む", new_order_path, class: "btn btn-success" %>
      </div>

    </div>
  </div>

</div>